function c(){const e=new Uint8Array(56);return window.crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function s(e){const o=new TextEncoder().encode(e),t=await window.crypto.subtle.digest("SHA-256",o);return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function p({clientId:e,redirectUri:r,scope:o="openid email profile https://www.googleapis.com/auth/spreadsheets"}){const t=c();sessionStorage.setItem("pkce_code_verifier",t);const n=await s(t),a=`https://accounts.google.com/o/oauth2/v2/auth?${new URLSearchParams({client_id:e,redirect_uri:r,response_type:"code",scope:o,access_type:"offline",prompt:"consent",code_challenge:n,code_challenge_method:"S256"}).toString()}`;try{console.log("[oauth] Google auth URL:",a)}catch{}return a}export{p as buildAuthUrl,s as generateCodeChallenge,c as generateCodeVerifier};
