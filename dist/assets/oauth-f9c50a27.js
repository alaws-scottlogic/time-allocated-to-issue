function i(){const e=new Uint8Array(56);return window.crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function s(e){const o=new TextEncoder().encode(e),t=await window.crypto.subtle.digest("SHA-256",o);return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function d({clientId:e,redirectUri:r,scope:o="openid email profile https://www.googleapis.com/auth/spreadsheets"}){const t=i(),n=await s(t);sessionStorage.setItem("pkce_code_verifier",t);const a=new URLSearchParams({client_id:e,redirect_uri:r,response_type:"code",scope:o,access_type:"offline",prompt:"consent",code_challenge:n,code_challenge_method:"S256"}),c=`https://accounts.google.com/o/oauth2/v2/auth?${a.toString()}`;try{console.log("[oauth] Google auth URL:",c),console.log("[oauth] redirect_uri parameter:",a.get("redirect_uri"))}catch{}return c}export{d as buildAuthUrl,s as generateCodeChallenge,i as generateCodeVerifier};
